<!DOCTYPE html>
<html lang="en">
<head>
    {{- partial "head.html" . -}}
    <meta name="description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta property="og:title" content="Subscribe & Save - Whipped Tallow Balm | PrimalCare" />
    <meta property="og:type" content="{{ .Site.Params.homepage_meta_tags.meta_og_type }}" />
    <meta property="og:url" content="{{ .Site.Params.homepage_meta_tags.meta_og_url }}" />
    <meta property="og:image" content="{{ .Site.Params.homepage_meta_tags.meta_og_image }}" />
    <meta property="og:description" content="Subscribe monthly and never run out of your favourite tallow balm. From $19.95/month." />
    <meta name="twitter:card" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_card }}" />
    <meta name="twitter:site" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_site }}" />
    <meta name="twitter:creator" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_creator }}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<style>
.custom-radio.out-of-stock input[type="radio"]:checked + .custom-radio-label::before {
    background-color: red;
}

.custom-radio.in-stock input[type="radio"]:checked + .custom-radio-label::before {
    background-color: green;
}

.custom-radio-label {
    color: inherit;
}

.subscription-badge {
    display: inline-block;
    background-color: #2d6a4f;
    color: #fff;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    letter-spacing: 0.02em;
}

.subscription-benefits {
    background: #fdf6ee;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 1.5rem;
}

.subscription-benefits ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.subscription-benefits ul li {
    padding: 6px 0;
    position: relative;
    padding-left: 28px;
}

.subscription-benefits ul li::before {
    content: "✓";
    position: absolute;
    left: 0;
    color: #2d6a4f;
    font-weight: bold;
}

.scent-option-card {
    border: 2px solid #e0d5c7;
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: border-color 0.2s, background-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.scent-option-card:hover {
    border-color: #b8a89a;
}

.scent-option-card.selected {
    border-color: #2d6a4f;
    background-color: #f6faf7;
}

.scent-option-card input[type="radio"] {
    display: none;
}

.scent-option-card .scent-name {
    font-weight: 600;
    font-size: 1.05rem;
}

.scent-option-card .scent-price {
    font-weight: 700;
    font-size: 1.1rem;
    color: #2d6a4f;
}

.scent-option-card .scent-tag {
    display: inline-block;
    background: #e8c547;
    color: #333;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: 8px;
}
</style>

{{- partial "alert.html" . -}}
{{- partial "header_new.html" . -}}

<div class="container product-page">
    <div class="row topbanner rel">
        <p class="text-dark col-12 ninety mt-1"><a href="/shop" class="text-dark text-decoration-underline">Shop</a> > <a href="/shop/tallow-balm" class="text-dark text-decoration-underline">Tallow balm</a> > Subscribe</p>
        <div class="col-12 col-lg-6 product-photos mb-3">
            {{- partial "tallowskinimages.html" . -}}
        </div>
        <div class="col-12 col-lg-6">
            <span class="subscription-badge mb-2">Subscribe & Save</span>
            <p class="fw-bold mt-2"><img class="stars pe-2" src="/img/stars/5.webp" alt="">Used by 20000+ kiwis.</p>
            <h1 class="fw-bold mt-2">Whipped Tallow Balm</h1>
            <p class="fw-lighter h1 h1big">Monthly Subscription</p>
            <p class="text-muted">120ml | From PrimalCare</p>
            <p class="fw-lighter">Never run out of your favourite balm — delivered to your door <span class="attention-primalcare">every month.</span></p>

            <!-- Subscription Benefits Box -->
            <div class="subscription-benefits">
                <ul>
                    <li>Fresh 120ml jar delivered monthly</li>
                    <li>Cancel or pause anytime — no lock-in</li>
                    <li>Free shipping on every delivery</li>
                    <li>Manage your subscription online</li>
                </ul>
            </div>

            <!-- SUBSCRIPTION FORM STARTS -->

            <div class="price-display fw-bold">
                <p class="mb-2"><span id="price">-</span>/month</p>
                <p class="fw-lighter">or 4 interest free payments of $<span id="afterpay_price"></span> with <img src="/img/afterpay.webp" class="d-inline" height="28" alt="afterpay"></p>
            </div>

            <form id="productForm" class="form-group mb-4" autocomplete="off">
                <!-- Hidden fields for fixed values -->
                <input type="hidden" name="orderType" value="monthly">
                <input type="hidden" name="size" value="120ml">

                <div class="text-left mb-3 mb-lg-4">
                    <label class="mob-ninety mb-2 fw-bold">Select your scent:</label>

                    <div class="scent-option-card selected" data-scent="vanilla-rose">
                        <div>
                            <input type="radio" id="vanilla-rose" name="flavor" value="vanilla-rose" checked>
                            <span class="scent-name">Vanilla & Rose</span>
                        </div>
                        <span class="scent-price">$19.95</span>
                    </div>

                    <div class="scent-option-card" data-scent="lavender">
                        <div>
                            <input type="radio" id="lavender" name="flavor" value="lavender">
                            <span class="scent-name">Lavender</span>
                        </div>
                        <span class="scent-price">$19.95</span>
                    </div>

                    <div class="scent-option-card" data-scent="frankincense">
                        <div>
                            <input type="radio" id="frankincense" name="flavor" value="frankincense">
                            <span class="scent-name">Frankincense</span>
                        </div>
                        <span class="scent-price">$19.95</span>
                    </div>

                    <div class="scent-option-card" data-scent="neutral">
                        <div>
                            <input type="radio" id="neutral" name="flavor" value="neutral">
                            <span class="scent-name">Natural (Unscented)</span>
                        </div>
                        <span class="scent-price">$19.95</span>
                    </div>

                    <div class="scent-option-card" data-scent="manuka">
                        <div>
                            <input type="radio" id="manuka" name="flavor" value="manuka">
                            <span class="scent-name">Mānuka</span>
                            <span class="scent-tag">Premium</span>
                        </div>
                        <span class="scent-price">$24.95</span>
                    </div>
                </div>

                <!-- Quantity Selector -->
                <div class="form-group mb-3 mb-lg-4">
                    <div class="mt-4 custom-radio float-end">
                        <input type="radio" id="inStock" name="stockStatus" checked>
                        <label class="custom-radio-label mb-0" for="inStock">In Stock</label>
                    </div>
                    <label for="quantityAll" class="form-label">Number of jars per month:</label>
                    <div class="quantity-container">
                        <button type="button" class="btn-decrease">-</button>
                        <input type="number" class="form-control" id="quantityAll" name="quantity" min="1" value="1">
                        <button type="button" class="btn-increase">+</button>
                    </div>
                </div>

                <!-- Subscribe Button -->
                <div class="add-to-cart text-center mb-4">
                    <button type="button" class="btn btn-black btn-lg buy-now mb-2" data-price-id="" data-quantity-id="quantityAll">Subscribe Now</button>
                    <p>Cancel anytime | Free shipping | Money back guarantee</p>
                    <img class="badges middle" src="/img/stripe-badge-transparent.webp" alt="stripe secure badges">
                </div>
            </form>

            <!-- SUBSCRIPTION FORM ENDS -->

        </div>
    </div>

    <div class="row mt-4 py-0 d-flex justify-content-center">
        <div class="col-12 col-md-6 text-center">
            <div class="col-12 text-center">
                <h2>As Featured on</h2>
                <div class="col-12 d-none d-md-block">
                    <img src="/img/shop/desktop-product-logos.webp" class="img-fluid">
                </div>
                <div class="col-12 d-block d-md-none">
                    <img src="/img/shop/mobile-logos.webp" class="img-fluid">
                </div>
            </div>
            <div class="row mt-4 mb-0 py-0">
                <div class="col-6">
                    <img src="/img/prod/balm/eczema.webp" alt="eczema">
                </div>
                <div class="col-6">
                    <img src="/img/prod/balm/baby-eczema.webp" alt="baby eczema">
                </div>
                <p>With oils closely mimicking those produced by our bodies, our tallow <span class="attention-primalcare">soothes dry and irritated skin</span></p>
            </div>
        </div>

        <div class="faq-tab-container col-12 col-md-6">
            <!-- Nav tabs -->
            <div class="faq-nav-tabs">
                <div class="faq-nav-tab active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true">Fast facts</div>
                <div class="faq-nav-tab" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</div>
                <div class="faq-nav-tab" id="ingredients-tab" data-toggle="tab" href="#ingredients" role="tab" aria-controls="ingredients" aria-selected="false">Ingredients</div>
                <div class="faq-nav-tab" id="directions-tab" data-toggle="tab" href="#directions" role="tab" aria-controls="directions" aria-selected="false">Directions</div>
                <div class="faq-nav-tab" id="subscription-tab" data-toggle="tab" href="#subscription" role="tab" aria-controls="subscription" aria-selected="false">Subscription</div>
            </div>

            <!-- Tab panes -->
            <div class="tab-content faq-tab-content">
                <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
                    <p>Don't waste another dollar on expensive moisturisers and steroid creams that often <span class="attention-primalcare">don't work</span> and are filled with <span class="attention-primalcare">chemical nasties!</span></p>
                    <p>Watch as light and fluffy balm soaks deeply into your skin, going to work giving rapid <span class="attention-primalcare">hydrating and rejuvenating relief</span> to dry, cracked and itchy skin.</p>
                    <p class="mt-4 h6">What makes Primalcare tallow balm different?</p>
                    <ul>
                        <li>It's a whipped tallow balm, most others aren't. Meaning it soaks in much better.</li>
                        <li>We offer the best value tallow on the NZ market–get more, at better quality, for less.</li>
                    </ul>
                    <div class="row text-center justify-content-around mt-0 mb-0">
                        <h3 class="h4">Meet your moisturiser match</h3>
                        <p>See why <span class="attention-primalcare">20000+ kiwis just like you</span> switched to Primalcare</p>
                        <img class="seventy" src="/img/comparison-card-primalcare-balm.svg" alt="balm">
                    </div>
                </div>

                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                    <h4>See what our customers say online</h4>
                    <img class="eighty middle" src="/img/prod/balm/balmreviews.webp" alt="reviews">
                </div>

                <div class="tab-pane fade" id="ingredients" role="tabpanel" aria-labelledby="ingredients-tab">
                    <h4>3 Nourishing Ingredients</h4>
                    <p>A harmonic combination that soaks in for immediate hydration</p>
                    <p>Grass-fed purified NZ beef tallow (98%), organic jojoba oil, essential oil.</p>
                    <div class="row text-center">
                        <div class="col-6">
                            <img src="/img/prod/balm/tallowwhite.webp" class="w-50 mb-2 middle" alt="Grass-fed beef tallow">
                            <p>We use high grade grass-fed suet, which we wet render and filter 6 times.</p>
                        </div>
                        <div class="col-6">
                            <img src="/img/prod/balm/jojobaoil.webp" class="w-50 mb-2 middle" alt="Organic cold pressed jojoba oil">
                            <p>Adding extra lift to the whip while providing smoothing and benefits to your skin.</p>
                        </div>
                        <div class="col-6">
                            <img src="/img/prod/balm/essentialoil.webp" class="w-50 mb-2 middle" alt="Natural essential oils">
                            <p>These add the aroma and additional health benefits to your balms.</p>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="directions" role="tabpanel" aria-labelledby="directions-tab">
                    <h4>Directions</h4>
                    <p>Apply a small amount on the face, neck, hands or feet daily in the morning as a moisturiser or evening as a night cream. Best used on slightly damp skin.</p>
                    <p>Body and facial moisturizer. Eczema cream, monthly hair conditioner.</p>
                    <p>For best texture and consistency when using, keep in temperatures between 18 and 25 degrees celsius and out of direct sunlight.</p>
                </div>

                <div class="tab-pane fade" id="subscription" role="tabpanel" aria-labelledby="subscription-tab">
                    <h4>How Subscriptions Work</h4>
                    <p><strong>Monthly delivery:</strong> Your 120ml jar(s) will be shipped automatically each month. Your first order ships immediately.</p>
                    <p><strong>Easy management:</strong> Log in to your account to pause, skip a month, change your scent, or update your delivery address at any time.</p>
                    <p><strong>Cancel anytime:</strong> No lock-in contracts. Cancel your subscription whenever you like — no questions asked.</p>
                    <p><strong>Free shipping:</strong> All subscription orders ship free within New Zealand.</p>
                    <p><strong>Billing:</strong> You'll be charged on the same date each month. We'll send you a reminder email 3 days before each renewal.</p>
                    <p>If you have any questions about subscriptions, please don't hesitate to <a href="/contact/">contact us</a>.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="section light-peach py-80 mt-5">
    {{- partial "irritation-routine.html" . -}}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tabs = document.querySelectorAll('.faq-nav-tab');
        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelector('.faq-nav-tab.active').classList.remove('active');
                tab.classList.add('active');
                var tabContent = document.querySelector('.faq-tab-content .tab-pane.show.active');
                tabContent.classList.remove('show', 'active');
                var target = tab.getAttribute('href');
                document.querySelector(target).classList.add('show', 'active');
            });
        });
    });
</script>

<!-- Include Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

<!-- SUBSCRIPTION PRICING SCRIPT -->
<script>
    // Load subscription pricing from Hugo data file
    const subscriptionPricingRaw = {{ site.Data.subscriptions | jsonify | safeJS }};
    console.log("Subscription Pricing Data:", subscriptionPricingRaw);

    // Scent card selection UI
    document.addEventListener('DOMContentLoaded', function () {
        const scentCards = document.querySelectorAll('.scent-option-card');

        scentCards.forEach(function (card) {
            card.addEventListener('click', function () {
                // Remove selected class from all cards
                scentCards.forEach(c => c.classList.remove('selected'));
                // Add selected to clicked card
                card.classList.add('selected');
                // Check the radio inside
                const radio = card.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                    // Trigger change event so price updates
                    radio.dispatchEvent(new Event('change', { bubbles: true }));
                }
            });
        });
    });

    // Price update function
    function updatePrice() {
        const flavor = document.querySelector('input[name="flavor"]:checked').value.trim().toLowerCase();
        console.log("Selected scent:", flavor);

        let price = null;

        // Look up price from subscriptions.yaml data
        if (subscriptionPricingRaw && subscriptionPricingRaw.balm && subscriptionPricingRaw.balm.monthly) {
            const flavorData = subscriptionPricingRaw.balm.monthly[flavor];
            if (flavorData && flavorData["120ml"]) {
                price = flavorData["120ml"][country_code] || flavorData["120ml"]["nz"];
            }
        }

        if (price !== null) {
            document.getElementById("price").textContent = `$${price.toFixed(2)}`;
            document.getElementById("afterpay_price").textContent = `${(price / 4).toFixed(2)}`;
        } else {
            document.getElementById("price").textContent = "N/A";
            document.getElementById("afterpay_price").textContent = "N/A";
        }
    }

    // Price ID update function
    function updatePriceId() {
        const flavor = document.querySelector('input[name="flavor"]:checked').value.trim().toLowerCase();

        let priceId = "";

        try {
            if (subscriptionPricingRaw && subscriptionPricingRaw.ids && subscriptionPricingRaw.ids.balm && subscriptionPricingRaw.ids.balm.monthly) {
                priceId = subscriptionPricingRaw.ids.balm.monthly[flavor]["120ml"][country_code] || "";
            }
        } catch (error) {
            console.error('Error fetching subscription Price ID:', error);
        }

        // Update the button's data-price-id attribute
        const buyNowButton = document.querySelector(".buy-now");
        if (buyNowButton) {
            buyNowButton.setAttribute("data-price-id", priceId);
            console.log('Button updated with Price ID:', priceId);
        }
    }

    // Attach event listeners
    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('productForm').addEventListener('change', function () {
            updatePrice();
            updatePriceId();
        });

        // Initialize on page load
        updatePrice();
        updatePriceId();
    });
</script>

<!-- ADD TO CART / SUBSCRIBE HANDLER -->
<script>
    function handleSubscribe(event) {
        event.preventDefault();
        console.log('Subscribe button clicked!');

        const button = event.target;
        const selectedFlavor = document.querySelector('input[name="flavor"]:checked');
        const flavor = document.querySelector(`label .scent-name`, document.querySelector(`.scent-option-card[data-scent="${selectedFlavor.value}"]`));

        // Get flavor display name from the selected card
        const selectedCard = document.querySelector('.scent-option-card.selected');
        const flavorName = selectedCard ? selectedCard.querySelector('.scent-name').textContent.trim() : selectedFlavor.value;

        const unitPriceElement = document.getElementById('price');
        const unitPrice = unitPriceElement
            ? parseFloat(unitPriceElement.textContent.replace('$', '').trim()) || 0.00
            : 0.00;

        const priceId = button.getAttribute('data-price-id') || 'N/A';
        const title = document.querySelector('h1').innerText;

        const quantityField = document.getElementById('quantityAll');
        const quantity = quantityField ? parseInt(quantityField.value, 10) || 1 : 1;

        console.log('Flavor:', flavorName);
        console.log('Quantity:', quantity);
        console.log('Price ID:', priceId);
        console.log('Unit Price:', unitPrice);

        if (!priceId || priceId === 'N/A' || priceId === '') {
            alert('Please select a valid scent before subscribing.');
            return;
        }

        // Add to cart with subscription flag
        const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
        cart.push({
            priceId,
            title,
            size: '120ml',
            flavor: flavorName,
            orderType: 'Monthly Subscription',
            quantity,
            unitPrice,
            isSubscription: true,
            eligibleForDiscount: false
        });
        localStorage.setItem('cartV2', JSON.stringify(cart));

        console.log('Cart updated:', cart);

        const modal = document.getElementById('addedToCartModal');
        if (modal) {
            $('#addedToCartModal').modal('show');
        } else {
            alert('Subscription added to cart!');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const subscribeButton = document.querySelector('.buy-now');
        if (subscribeButton) {
            subscribeButton.addEventListener('click', handleSubscribe);
            console.log('Subscribe button is ready.');
        } else {
            console.error('Subscribe button not found!');
        }
    });
</script>

<!-- Modal for Add to Cart Confirmation -->
<div class="modal fade" id="addedToCartModal" tabindex="-1" aria-labelledby="addedToCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addedToCartModalLabel">Subscription Added to Cart</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Your monthly subscription has been added to the cart. What would you like to do next?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Continue Shopping</button>
                <a href="/cart" class="btn btn-black">Go to Cart</a>
            </div>
        </div>
    </div>
</div>

<!-- Quantity buttons -->
<script>
    const quantityInput = document.getElementById('quantityAll');
    const btnIncrease = document.querySelector('.btn-increase');
    const btnDecrease = document.querySelector('.btn-decrease');

    btnIncrease.addEventListener('click', () => {
        quantityInput.value = parseInt(quantityInput.value) + 1;
    });

    btnDecrease.addEventListener('click', () => {
        const currentValue = parseInt(quantityInput.value);
        if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
        }
    });
</script>

<!-- Stock status (simplified for subscription - no out-of-stock combos needed currently) -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const flavorOptions = document.querySelectorAll('input[name="flavor"]');
        const stockLabel = document.querySelector('label[for="inStock"]');
        const addToCartButton = document.querySelector('.buy-now');

        // Define out-of-stock scents if needed
        const outOfStockFlavors = [
        ];

        function updateStockLabel() {
            const selectedFlavor = document.querySelector('input[name="flavor"]:checked').value;

            const isOutOfStock = outOfStockFlavors.includes(selectedFlavor);

            document.querySelectorAll('.custom-radio').forEach(radio => {
                radio.classList.remove('out-of-stock', 'in-stock');
            });

            if (isOutOfStock) {
                stockLabel.textContent = "Temporarily out of Stock";
                stockLabel.style.color = "red";
                addToCartButton.disabled = true;
                addToCartButton.style.backgroundColor = "gray";
                addToCartButton.style.cursor = "not-allowed";
                document.querySelectorAll('.custom-radio').forEach(radio => {
                    radio.classList.add('out-of-stock');
                });
            } else {
                stockLabel.textContent = "In Stock";
                stockLabel.style.color = "green";
                addToCartButton.disabled = false;
                addToCartButton.style.backgroundColor = "";
                addToCartButton.style.cursor = "pointer";
                document.querySelectorAll('.custom-radio').forEach(radio => {
                    radio.classList.add('in-stock');
                });
            }
        }

        flavorOptions.forEach(option => {
            option.addEventListener('change', updateStockLabel);
        });

        updateStockLabel();
    });
</script>

{{- partial "footer.html" . }}

</body>
</html>
