<!DOCTYPE html>
<html lang="en">
<head>
    {{- partial "head.html" . -}}
    <meta name="description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta property="og:title" content="{{ .Site.Params.homepage_meta_tags.meta_og_title }}" />
    <meta property="og:type" content="{{ .Site.Params.homepage_meta_tags.meta_og_type }}" />
    <meta property="og:url" content="{{ .Site.Params.homepage_meta_tags.meta_og_url }}" />
    <meta property="og:image" content="{{ .Site.Params.homepage_meta_tags.meta_og_image }}" />
    <meta property="og:description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta name="twitter:card" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_card }}" />
    <meta name="twitter:site" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_site }}" />
    <meta name="twitter:creator" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_creator }}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* New Product Form Styles */
        .product-form-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        .product-form-label {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            width: 44px;
            flex-shrink: 0;
        }
        .product-radio-group {
            display: flex;
            flex: 1;
            background-color: #f0f0f0;
            border-radius: 8px;
            padding: 4px;
        }
        .product-radio-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background-color: transparent;
            cursor: pointer;
            font-size: 13px;
            font-weight: 400;
            color: #666;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0px;
            transition: all 0.15s ease;
        }
        .product-radio-btn .btn-main {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .product-radio-btn .btn-sub {
            font-size: 10px;
            color: #888;
            font-weight: 500;
            margin-top: 2px;
        }
        .product-radio-btn .btn-sub .highlight {
            color: #E91E8C;
            font-weight: 600;
        }
        .product-radio-btn.active {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-weight: 600;
            color: #333;
        }
        .product-radio-btn img {
            height: 22px;
        }
        .product-radio-btn.scent-btn {
            flex-direction: row;
            padding: 10px 8px;
        }
        .badge-pink-solid {
            background-color: #E91E8C;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-blue-solid {
            background-color: #4169E1;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .badge-yellow-solid {
            background-color: #F4D03F;
            color: #333;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .qty-container {
            display: flex;
            align-items: center;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        .qty-btn {
            width: 40px;
            height: 40px;
            border: none;
            background-color: #f5f5f5;
            font-size: 18px;
            cursor: pointer;
        }
        .qty-value {
            width: 44px;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
        }
        .stock-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: auto;
        }
        .stock-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #4CAF50;
        }
        .stock-text {
            color: #4CAF50;
            font-weight: 600;
            font-size: 13px;
        }
        .price-display-new {
            display: flex;
            align-items: baseline;
            gap: 6px;
            justify-content: flex-end;
        }
        .price-main {
            font-size: 28px;
            font-weight: 700;
            color: #2D2A26;
        }
        .price-badges {
            display: flex;
            gap: 4px;
            justify-content: flex-end;
            margin-top: 4px;
        }
        .btn-add-cart {
            width: 100%;
            padding: 18px;
            background-color: #2D2A26;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .btn-add-cart:hover {
            background-color: #1a1816;
        }

        /* Hide original form elements, show new ones */
        #productForm .text-left { display: none !important; }
        #productForm .form-group { display: none; }
        #productForm .add-to-cart { display: none; }
        .new-product-form { display: block; }
    </style>
</head>
<body>
{{- partial "alert.html" . -}}
{{- partial "header_new.html" . -}}

<div class="container product-page">
    <div class="row topbanner rel">
        <p class="text-dark col-12 ninety mt-1"><a href="/shop" class="text-dark text-decoration-underline">Shop</a> > Tallow Dish Block</p>
        
        <div class="col-12 col-lg-6 product-photos mb-3">
            {{- partial "images-dish-soap.html" . -}}
        </div>
        
        <div class="col-12 col-lg-6">
            <p class="fw-bold mt-2">NEW <br>Online Only! - Not in Stores</p>
            
            <h1 class="fw-bold mt-2 mb-0">Tallow Dish Block</h1>
            <p class="fw-lighter h1 h1big mb-0">Non-Toxic Dish Soap</p>
            <p class="text-muted mb-2" style="font-size: 14px;">From PrimalPantry</p>
            <p class="fw-lighter mb-2">Simply clean and sparkly dishes the old fashioned way, without plastic or artificial stuff.</p>
            
            <!-- Price -->
            <div class="mb-2">
                <div class="price-display-new" style="justify-content: flex-start;">
                    <span class="price-main" id="price">$29.95</span>
                </div>
                <div class="price-badges" id="price-badges" style="justify-content: flex-start;">
                    <span class="badge-blue-solid">No Tox</span>
                    <span class="badge-yellow-solid">LEMON</span>
                </div>
            </div>
            
            <!-- Afterpay -->
            <p class="fw-lighter mb-3" id="afterpay-line">or 4 interest free payments of $<span id="afterpay_price">7.49</span> with <img src="/img/afterpay.webp" class="d-inline" height="28" alt="afterpay"></p>

            <!-- Form -->
            <form id="productForm" class="form-group mb-4" autocomplete="off">
                
                <!-- Hidden original inputs for compatibility -->
                <input type="radio" id="single_purchase" name="orderType" value="single_purchase" checked style="display:none">
                <input type="radio" id="lemon" name="flavor" value="lemon" checked style="display:none">
                <input type="radio" id="size350g" name="size" value="350g" checked style="display:none">

                <div class="new-product-form">
                    <!-- Scent (Lemon only for now) -->
                    <div class="product-form-row" id="scent-row">
                        <span class="product-form-label">Scent</span>
                        <div class="product-radio-group">
                            <button type="button" class="product-radio-btn scent-btn active" data-value="lemon" id="btn-lemon">üçã Lemon</button>
                        </div>
                    </div>

                    <!-- Size (350g only) -->
                    <div class="product-form-row" id="size-row">
                        <span class="product-form-label">Size</span>
                        <div class="product-radio-group">
                            <button type="button" class="product-radio-btn active" data-value="350g" id="btn-350g">
                                <span class="btn-main">350g Block</span>
                                <span class="btn-sub" id="price-350g">$29.95</span>
                            </button>
                        </div>
                    </div>

                    <!-- Quantity -->
                    <div class="product-form-row">
                        <span class="product-form-label">Qty</span>
                        <div class="qty-container">
                            <button type="button" class="qty-btn" id="qty-decrease">‚àí</button>
                            <span class="qty-value" id="qty-display">1</span>
                            <button type="button" class="qty-btn" id="qty-increase">+</button>
                        </div>
                        <input type="hidden" id="quantityAll" name="quantity" value="1">
                        <div class="stock-indicator">
                            <span class="stock-dot"></span>
                            <span class="stock-text">In Stock</span>
                        </div>
                    </div>

                    <!-- Add to Cart -->
                    <button type="button" class="btn-add-cart buy-now" id="add-to-cart-btn" data-price-id="" data-quantity-id="quantityAll">
                        Add To Cart
                    </button>
                    <p class="text-center text-muted small" id="shipping-text">üöö Speedy Shipping NZ Wide | Money back guarantee</p>
                    <div class="text-center">
                        <img class="badges middle" src="/img/stripe-badge-transparent.webp" alt="stripe secure badges">
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row mt-4 py-0 d-flex justify-content-center">
        <div class="col-12 col-md-6 text-center">
            <div class="col-12 text-center">
                <h2>As Featured on</h2>
                <div class="col-12 d-none d-md-block">
                    <img src="/img/shop/desktop-product-logos.webp" class="img-fluid">
                </div>
                <div class="col-12 d-block d-md-none">
                    <img src="/img/shop/mobile-logos.webp" class="img-fluid">
                </div>
            </div>
            
        </div>
        
        <div class="faq-tab-container col-12 col-md-6">
            <!-- Nav tabs -->
            <div class="faq-nav-tabs">
                <div class="faq-nav-tab active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true">Fast facts</div>
               <!-- <div class="faq-nav-tab" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</div> -->
                <div class="faq-nav-tab" id="ingredients-tab" data-toggle="tab" href="#ingredients" role="tab" aria-controls="ingredients" aria-selected="false">Ingredients</div>
                <div class="faq-nav-tab" id="directions-tab" data-toggle="tab" href="#directions" role="tab" aria-controls="directions" aria-selected="false">Directions</div>
                <div class="faq-nav-tab" id="shipping-tab" data-toggle="tab" href="#shipping" role="tab" aria-controls="shipping" aria-selected="false">Shipping</div>
            </div>

            <!-- Tab panes -->
            <div class="tab-content faq-tab-content">
                <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">        
                    <p>Clean your dishes the old-fashioned way with our Tallow Dish Block ‚Äì a non-toxic, long-lasting solid dish soap made with grass-fed tallow and natural ingredients.</p>
                    <p>Say goodbye to plastic bottles and harsh chemicals. Our dish block cuts through grease naturally while being gentle on your hands and kind to the environment. One block lasts for months!</p>
                    <h4>Benefits</h4>
                    <ul>
                        <li>Low-tox formula ‚Äì no artificial nasties</li>
                        <li>Natural ingredients ‚Äì grass-fed tallow based</li>
                        <li>Long-lasting ‚Äì one block lasts months</li>
                        <li>Plastic-free ‚Äì zero waste packaging</li>
                        <li>Gentle on hands ‚Äì won't dry out your skin</li>
                        <li>Cuts through grease naturally</li>
                        <li>Fresh lemon scent</li>
                    </ul>
                </div>
                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                    <h4>See what our customers say online</h4>
                    <img class="eighty middle" src="/img/prod/balm/balmreviews.webp" alt="reviews">
                </div>
                <div class="tab-pane fade" id="ingredients" role="tabpanel" aria-labelledby="ingredients-tab">
                    <h4>Ingredients</h4>
                    <div class="row text-center">
                        <div class="col-6">
                            <h5 class="fw-bold">Grass-Fed Tallow</h5>
                            <p>Natural cleansing base that cuts through grease effectively while being gentle on hands.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Coconut Oil</h5>
                            <p>Creates a rich, foamy lather and adds cleansing power.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Castor Oil</h5>
                            <p>Boosts bubbles and helps condition hands while washing.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Lemon Essential Oil</h5>
                            <p>Natural degreaser with a fresh, clean citrus scent.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Sodium Hydroxide (Lye)</h5>
                            <p>Used in saponification process ‚Äì none remains in final product after curing.</p>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="directions" role="tabpanel" aria-labelledby="directions-tab">
                    <h4>Directions</h4>
                    <p><strong>For handwashing:</strong> Wet your dish brush or sponge, rub it directly on the block to create suds, then wash dishes as normal. Rinse and let the block dry between uses.</p>
                    <p><strong>Storage tip:</strong> Keep the block on a draining dish or soap dish to extend its life. Allow to dry between uses.</p>
                    <p><strong>Pro tip:</strong> Works great on pots, pans, greasy dishes, and even as a pre-treatment for stubborn stains on laundry!</p>
                </div>
                <div class="tab-pane fade" id="shipping" role="tabpanel" aria-labelledby="shipping-tab">
                    <h4>Shipping</h4>
                    <p><strong>Processing time:</strong> Your order will be processed within 3 business days after which you can expect usual courier times to your area (generally 3-5 business days)</p>
                    <p><strong>Shipping rates:</strong> We usually charge between $4.95 and $6.95 for shipping. You can view the shipping costs at the checkout before completing your purchase.</p>
                    <p><strong>International shipping:</strong> Currently, we only offer shipping within New Zealand. We apologize for any inconvenience this may cause.</p>
                    <p>If you have any questions or concerns regarding shipping, please don't hesitate to <a href="/contact/">contact us</a>.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tab switching script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tabs = document.querySelectorAll('.faq-nav-tab');
        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelector('.faq-nav-tab.active').classList.remove('active');
                tab.classList.add('active');
                var tabContent = document.querySelector('.faq-tab-content .tab-pane.show.active');
                tabContent.classList.remove('show', 'active');
                var target = tab.getAttribute('href');
                document.querySelector(target).classList.add('show', 'active');
            });
        });
    });
</script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

<!-- Pricing Data -->
<script>
    const productPricingRaw = {{ site.Data.pricing.tallow.pricing.dish | jsonify | safeJS }};
    const country_code = getCountryCookie('country_code') || "NZ";
    const rawData = "{{ .Site.Data.pricing | jsonify }}";
    const pricingData = JSON.parse(rawData);

    // Pricing lookup (350g only)
    const pricing = {
        single: 29.95
    };

    // State
    let state = {
        quantity: 1
    };

    function getPrice() {
        return pricing.single;
    }

    function updateUI() {
        const price = getPrice();
        
        // Update main price
        document.getElementById('price').textContent = '$' + price.toFixed(2);
        
        // Update size price
        document.getElementById('price-350g').textContent = '$' + price.toFixed(2);
        
        // Update afterpay
        document.getElementById('afterpay_price').textContent = (price / 4).toFixed(2);
        
        // Trigger original price ID update
        if (typeof updatePriceId === 'function') {
            updatePriceId();
        }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
        // Quantity
        document.getElementById('qty-increase').addEventListener('click', function() {
            state.quantity++;
            document.getElementById('qty-display').textContent = state.quantity;
            document.getElementById('quantityAll').value = state.quantity;
        });
        document.getElementById('qty-decrease').addEventListener('click', function() {
            if (state.quantity > 1) {
                state.quantity--;
                document.getElementById('qty-display').textContent = state.quantity;
                document.getElementById('quantityAll').value = state.quantity;
            }
        });
        
        // Initial UI update
        updateUI();
    });
</script>

<!-- Original pricing scripts for cart compatibility -->
<script>
    function updatePriceId() {
        const size = document.querySelector('input[name="size"]:checked').value.trim().toLowerCase();
        const flavor = document.querySelector('input[name="flavor"]:checked').value.trim().toLowerCase();
        const orderType = document.querySelector('input[name="orderType"]:checked').value.trim().toLowerCase();

        try {
            let priceId;

            if (orderType === 'single_purchase') {
                priceId = pricingData.tallow.ids.dish.single[flavor][size][country_code];
            }

            const buyNowButton = document.querySelector(".buy-now");
            if (buyNowButton) {
                buyNowButton.setAttribute("data-price-id", priceId || "");
            }
        } catch (error) {
            console.error('Error fetching Price ID:', error);
        }
    }
</script>

<!-- Add to Cart Handler -->
<script>
    function handleAddToCart(event) {
        event.preventDefault();
        const button = event.target;

        const unitPrice = parseFloat(document.getElementById('price').textContent.replace('$', '').trim()) || 0;
        const priceId = button.getAttribute('data-price-id') || 'N/A';
        const title = document.querySelector('h1').innerText;
        const quantity = parseInt(document.getElementById('quantityAll').value, 10) || 1;

        if (!priceId || priceId === 'N/A') {
            alert('Please select valid options before adding to cart.');
            return;
        }

        const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
        cart.push({
            priceId,
            title,
            size: '350g',
            flavor: 'Lemon',
            orderType: 'Single block',
            quantity,
            unitPrice,
            eligibleForDiscount: false
        });
        localStorage.setItem('cartV2', JSON.stringify(cart));

        const modal = document.getElementById('addedToCartModal');
        if (modal) {
            $('#addedToCartModal').modal('show');
        } else {
            alert('Item added to cart successfully!');
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const addToCartButton = document.querySelector('.buy-now');
        if (addToCartButton) {
            addToCartButton.addEventListener('click', handleAddToCart);
        }
    });
</script>

<!-- Modal for Add to Cart Confirmation -->
<div class="modal fade" id="addedToCartModal" tabindex="-1" aria-labelledby="addedToCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addedToCartModalLabel">Item Added to Cart</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Your item has been successfully added to the cart. What would you like to do next?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Continue Shopping</button>
                <a href="/cart" class="btn btn-black">Go to Cart</a>
            </div>
        </div>
    </div>
</div>

{{- partial "footer.html" . }}

</body>
</html>
