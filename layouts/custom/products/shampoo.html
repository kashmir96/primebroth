<!DOCTYPE html>
<html lang="en">
<head>
    {{- partial "head.html" . -}}
    <meta name="description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta property="og:title" content="{{ .Site.Params.homepage_meta_tags.meta_og_title }}" />
    <meta property="og:type" content="{{ .Site.Params.homepage_meta_tags.meta_og_type }}" />
    <meta property="og:url" content="{{ .Site.Params.homepage_meta_tags.meta_og_url }}" />
    <meta property="og:image" content="{{ .Site.Params.homepage_meta_tags.meta_og_image }}" />
    <meta property="og:description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta name="twitter:card" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_card }}" />
    <meta name="twitter:site" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_site }}" />
    <meta name="twitter:creator" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_creator }}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <style> 
        .custom-radio input[type="radio"]:checked + .custom-radio-label::before {
            background-color: green;
        }

        .custom-radio.out-of-stock .custom-radio-label {
            color: red;
        }

        .custom-radio-label {
            color: green;
        }

        /* Button styles for routine partial */
        .btn-pink {
            background-color: #ffb6c1 !important;
            color: #000 !important;
            border: none !important;
            padding: 10px 20px !important;
            border-radius: 5px !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
            display: inline-block !important;
        }

        .btn-pink:hover {
            background-color: #ff9eb0 !important;
            color: #000 !important;
        }

        .btn-pink:disabled,
        .btn-pink.added {
            background-color: #98fb98 !important;
            color: #000 !important;
            cursor: default !important;
        }

        /* Pair With Section Styles */
        .pair-with-section .card {
            border-radius: 12px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .pair-with-section .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1) !important;
        }

        .pair-with-image img {
            transition: transform 0.3s ease;
        }

        .pair-with-image:hover img {
            transform: scale(1.05);
        }

        .pair-with-section .btn-pink {
            padding: 6px 14px !important;
            font-size: 13px !important;
        }

        /* Toast Notification for Pair With */
        .pair-with-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.25);
            z-index: 999999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            max-width: 90vw;
            width: auto;
        }

        .pair-with-toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .pair-with-toast-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pair-with-toast-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .pair-with-toast-text strong {
            font-size: 14px;
            color: #333;
        }

        .pair-with-toast-text span {
            font-size: 12px;
            color: #666;
        }

        .pair-with-toast-btn {
            background: #000;
            color: #fff !important;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none !important;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            margin-left: 8px;
        }

        .pair-with-toast-btn:hover {
            background: #333;
        }

        @media (max-width: 767px) {
            .pair-with-toast {
                bottom: 80px;
                left: 10px;
                right: 10px;
                transform: translateX(0) translateY(100px);
                max-width: none;
                width: auto;
            }
            
            .pair-with-toast.show {
                transform: translateX(0) translateY(0);
            }

            .pair-with-section .d-flex {
                flex-direction: row;
            }

            .pair-with-image {
                min-width: 80px;
            }

            .pair-with-image img {
                max-width: 80px !important;
            }
        }
    </style>
    
    {{ if .Params.charity }}
    <div class="announcement full-width black text-center">
        <ul>
            <li>Proceeds from this page are donated to {{ .Params.charity }}.</li>
        </ul>
    </div>
    {{ else }}
    {{- partial "alert.html" . -}}
    {{ end }}

    {{- partial "header_new.html" . -}}
    <div class="scroll-top rounded-full">
        <span class="icon-keyboard_arrow_up text-2xl"></span>
    </div>
    {{- partial "slide.html" . -}}
    {{- partial "strip.html" . -}}

    <div class="container product-page">
        <div class="row topbanner rel">
            <p class="text-muted ninety position-absolute mt-1"><a href="/shop" class="darktext-muted front pl-2 text-decoration-underline">Shop</a> > Tallow Shampoo Bar</p>
            <div class="col-12 col-lg-6 product-photos mb-3">
                <div class="row">
                    <img class="main-image" fetchpriority="high" src="/img/shampoobar/shampoo-bar.webp" alt="Main Product Image">
                    <div class="product-images">
                        <img class="product-image" src="/img/shampoobar/tallow-shampoo-bar-product-benifitswebp.webp" alt="Shampoo bar benefits">
                        <img class="product-image" src="/img/shampoo-hands.webp" alt="Shampoo bar in hands">
                        <img class="product-image" src="/img/shampoo-shop.webp" alt="Shampoo bar product">
                    </div>
                </div>
            </div>         
        
            <div class="col-xs-12 col-lg-6">
                <img class="stars float-left mr-2" src="/img/stars/5.webp" alt=""><p class="thic">Used by 6000+ kiwis <br>Online Only, Not in Stores</p>
                <h1 class="thic mt-2">Tallow Shampoo Bar</h1>
                <p class="thin h1big">Scalp Health Natural Shampoo</p>
                <p class="thin">Glowing hair, healthy scalp—your friends will <span class="attention-primalcare">beg for your secret!</span></p>

                <!-- PRODUCT FORM -->
                <div class="price-display thic">
                    <p class="mb-2"><span id="price">-</span> <span class="special" id="special">30% off!</span></p>    
                    <p class="thin">or 4 interest free payments of $<span id="afterpay_price"></span> with <img src="/img/afterpay.webp" class="d-inline" height="28"></p>                
                </div>

                <form id="productForm" class="form-group mb-4">          
                    <div class="text-left mb-3 mb-lg-4">
                        <label class="mob-ninety mr-2">Select unit type:</label>
                        <input type="radio" id="single_purchase" name="orderType" value="single_purchase" checked>
                        <label for="single_purchase" class="product-form-radio"><img class="prod-radio-img" src="/img/radio/resell/Shampoo.webp">Single block</label>
                        <!-- Uncomment below to enable 3-pack option
                        <input type="radio" id="three_pack" name="orderType" value="three_pack">
                        <label for="three_pack" class="product-form-radio"><img class="prod-radio-img" src="/img/radio/resell/Shampoo.webp" alt="3 pack shampoo">3 pack <span class="attention-primalcare small">(Save 33% + GIFT)</span></label>
                        -->
                    </div>

                    <!-- Hidden flavor selector (only one option) -->
                    <div class="text-left mb-3 mb-lg-4" style="display:none;">
                        <label class="float-left mr-2">Select flavor:</label>
                        <div class="product-form-radio">
                            <input type="radio" id="peppermintrosemary" name="flavor" value="peppermintrosemary" checked>
                            <label for="peppermintrosemary" class="product-form-radio">Natural</label>
                        </div>
                    </div>                    

                    <!-- Hidden size selector (only one option) -->
                    <div class="text-left mb-3 mb-lg-4" style="display:none;">
                        <label class="float-left mr-2">Select size:</label>
                        <div class="product-form-radio">
                            <input type="radio" id="size120g" name="size" value="120g" checked>
                            <label for="size120g" class="product-form-radio"><img class="prod-radio-img" src="/img/radio/resell/Shampoo.webp">100g</label>
                        </div>
                    </div>

                    <!-- Quantity Selector -->
                    <div class="form-group mb-3 mb-lg-4">
                        <div class="mt-4 custom-radio float-right">
                            <input type="radio" id="inStock" name="stockStatus" checked>
                            <label class="custom-radio-label mb-0" for="inStock">In stock</label>
                        </div>
                        <label for="quantityAll" class="form-label">Quantity of units:</label>
                        <div class="quantity-container">
                            <button type="button" class="btn-decrease">-</button>
                            <input type="number" class="form-control" id="quantityAll" name="quantity" min="1" value="1">
                            <button type="button" class="btn-increase">+</button>
                        </div>
                    </div>

                    <!-- Add to Cart Button -->
                    <div class="add-to-cart text-center mb-4">
                        <button type="button" class="btn btn-primary btn-lg buy-now mb-1" data-price-id="" data-quantity-id="quantityAll">Add To Cart</button>
                        <p>Speedy Shipping NZ Wide | Money back guarantee</p>
                        <img class="badges middle" src="/img/stripe-badge-transparent.webp" alt="stripe secure badges">
                    </div>
                </form>

                <!-- Pair With Section -->
                <div class="pair-with-section">
                    <div class="card border-0 shadow-sm">
                        <div class="card-body p-3">
                            <p class="text-muted small mb-2 fw-bold" style="font-weight: 600; letter-spacing: 0.5px;">PAIR WITH</p>
                            <div class="d-flex align-items-center">
                                <div class="pair-with-image mr-3">
                                    <a href="/shop/products/tallow-conditioner/">
                                        <img src="/img/conditioner-shop.webp" alt="Tallow Conditioner" class="img-fluid" style="max-width: 100px; border-radius: 8px;">
                                    </a>
                                </div>
                                <div class="pair-with-details flex-grow-1">
                                    <h6 class="mb-1 fw-bold" style="font-weight: 600;">
                                        <a href="/shop/products/tallow-conditioner/" class="text-decoration-none text-dark">
                                            Tallow Conditioner 500ml - Hair Repair
                                        </a>
                                    </h6>
                                    <p class="small text-muted mb-2">Nature's answer to dull, damaged and frizzy hair</p>
                                    <div class="d-flex align-items-center justify-content-between">
                                        <span class="h6 fw-bold mb-0 pair-with-price" 
                                              data-product="conditioner"
                                              data-size="500ml"
                                              data-order-type="single_purchase"
                                              style="font-weight: 600;">$34.95</span>
                                        <button 
                                            class="btn btn-pink btn-sm pair-with-quick-add" 
                                            data-product="conditioner"
                                            data-order-type="single"
                                            data-flavor="geranium"
                                            data-size="500ml"
                                            data-title="Nourishing Tallow Conditioner"
                                            data-display-size="500ml"
                                            data-display-flavor="Fresh Geranium"
                                            data-display-order-type="Single bottle">
                                            Quick Add
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-0">
                <div class="col-12 col-md-6 text-center">
                    <div class="col-12 text-center">
                        <h2>As Featured on</h2>
                        <div class="col-12 d-none d-md-block">
                            <img src="/img/shop/desktop-product-logos.webp" class="img-fluid">
                        </div>
                        <div class="col-12 d-block d-md-none">
                            <img src="/img/shop/mobile-logos.webp" class="img-fluid">
                        </div>
                    </div>
                </div>

                <div class="faq-tab-container col-12 col-md-6">
                    <!-- Nav tabs -->
                    <div class="faq-nav-tabs">
                        <div class="faq-nav-tab active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true">Fast facts</div>
                        <div class="faq-nav-tab" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</div>
                        <div class="faq-nav-tab" id="ingredients-tab" data-toggle="tab" href="#ingredients" role="tab" aria-controls="ingredients" aria-selected="false">Ingredients</div>
                        <div class="faq-nav-tab" id="directions-tab" data-toggle="tab" href="#directions" role="tab" aria-controls="directions" aria-selected="false">Directions</div>
                        <div class="faq-nav-tab" id="storage-tab" data-toggle="tab" href="#storage" role="tab" aria-controls="storage" aria-selected="false">Storage</div>
                        <div class="faq-nav-tab" id="shipping-tab" data-toggle="tab" href="#shipping" role="tab" aria-controls="shipping" aria-selected="false">Shipping</div>
                    </div>
                    
                    <!-- Tab panes -->
                    <div class="tab-content faq-tab-content">
                        <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">  
                            <h4>Why use a tallow shampoo bar?</h4>      
                            <p>Don't waste another dollar on chemical-laden shampoos that strip your hair and irritate your scalp!</p>
                            <p>Cleanse, moisturize, and nourish your hair with a tallow shampoo bar—hydrating and soothing dry, itchy, and rashy prone skin on the scalp.</p>
                            <p>Gentle yet effective, it leaves your hair clean, soft, and conditioned—all without the plastic waste of traditional bottles.</p>
                            <p>Give your hair and scalp the love they deserve with a shampoo bar gifted straight from Mother Nature!</p>
                        </div>

                        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                            <h4>See what our customers say online</h4>
                            <img class="eighty middle" src="/img/shampoo-reviews.webp" alt="reviews">
                        </div>
                    
                        <div class="tab-pane fade" id="ingredients" role="tabpanel" aria-labelledby="ingredients-tab">
                            <h4>Ingredients</h4>
                            <p>Grass-Fed Beef Tallow, Olive Oil, Coconut Oil, Castor Oil Lye (none remains in product after 4 weeks of curing).</p>
                        </div>
                    
                        <div class="tab-pane fade" id="directions" role="tabpanel" aria-labelledby="directions-tab">
                            <h4>Directions</h4>
                            <p>Lather in your hands before running them through your hair. Rinse after washing hair. Try to keep the block dry to avoid it decaying prematurely</p>
                        </div>
                    
                        <div class="tab-pane fade" id="storage" role="tabpanel" aria-labelledby="storage-tab">
                            <h4>Storage</h4>
                            <p>Store in a dry, cool place away from direct sunlight to extend the shelf life of the soap.</p>
                        </div>
                    
                        <div class="tab-pane fade" id="shipping" role="tabpanel" aria-labelledby="shipping-tab">
                            <h4>Shipping</h4>
                            <p><strong>Processing time:</strong> Your order will be processed within 3 business days after which you can expect usual courier times to your area (generally 3-5 business days)</p>
                            <p><strong>Shipping rates:</strong> Shipping is available for $6.95 to most areas of NZ.</p>
                            <p><strong>International shipping:</strong> Currently, we only offer shipping within New Zealand. We apologize for any inconvenience this may cause.</p>
                            <p>If you have any questions or concerns regarding shipping, please don't hesitate to <a href="/contact/">contact us</a>.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification for Pair With -->
    <div id="pairWithToast" class="pair-with-toast">
        <div class="pair-with-toast-content">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#98fb98" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </svg>
            <div class="pair-with-toast-text">
                <strong>Added to Cart!</strong>
                <span id="pairWithToastProduct"></span>
            </div>
            <a href="/cart" class="pair-with-toast-btn">View Cart</a>
        </div>
    </div>

    {{- partial "irritation-routine.html" . -}}

    <!-- Tab Navigation Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var tabs = document.querySelectorAll('.faq-nav-tab');
        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelector('.faq-nav-tab.active').classList.remove('active');
                tab.classList.add('active');
                var tabContent = document.querySelector('.faq-tab-content .tab-pane.show.active');
                tabContent.classList.remove('show', 'active');
                var target = tab.getAttribute('href');
                document.querySelector(target).classList.add('show', 'active');
            });
        });
    });
    </script>

    {{- partial "stripe.html" . -}}    
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <!-- PRICING SCRIPTS -->
    <script>
    const productPricingRaw = {{ site.Data.pricing.tallow.pricing.shampoo | jsonify | safeJS }};
    const productPricing = Array.isArray(productPricingRaw) ? productPricingRaw : [];

    function updatePrice() {
        const size = document.querySelector('input[name="size"]:checked').value.trim().toLowerCase();
        const orderType = document.querySelector('input[name="orderType"]:checked').value.trim().toLowerCase();

        const pricingEntry = productPricing.find(entry => entry.size.toLowerCase() === size);
        if (pricingEntry && pricingEntry.prices[country_code][orderType]) {
            const price = pricingEntry.prices[country_code][orderType];
            document.getElementById("price").textContent = `$${price.toFixed(2)}`;
            document.getElementById("afterpay_price").textContent = `${(price/4).toFixed(2)}`;
        } else {
            document.getElementById("price").textContent = "N/A";
            document.getElementById("afterpay_price").textContent = "N/A";
        }

        const specialBadge = document.getElementById("special");
        if (specialBadge) {
            specialBadge.textContent = orderType === 'three_pack' ? "33% off + Free Gift!" : "30% off!";
        }
    }

    document.getElementById("productForm").addEventListener("change", updatePrice);
    document.addEventListener("DOMContentLoaded", updatePrice);
    </script>

    <script>
    const rawData = "{{ .Site.Data.pricing | jsonify }}";
    const pricingData = JSON.parse(rawData);

    function updatePriceId() {
        const size = document.querySelector('input[name="size"]:checked').value.trim().toLowerCase();
        const flavor = document.querySelector('input[name="flavor"]:checked').value.trim().toLowerCase();
        const orderType = document.querySelector('input[name="orderType"]:checked').value.trim().toLowerCase();

        try {
            let priceId;
            if (orderType === 'single_purchase') {
                priceId = pricingData.tallow.ids.shampoo.single[flavor][size][country_code];
            } else if (orderType === 'recurring_monthly') {
                priceId = pricingData.tallow.ids.shampoo.monthly[flavor][size][country_code];
            } else if (orderType === 'recurring_quarterly') {
                priceId = pricingData.tallow.ids.shampoo.quarterly[flavor][size][country_code];
            } else if (orderType === 'three_pack') {
                priceId = pricingData.tallow.ids.shampoo.pack[flavor][size][country_code];
            }

            const buyNowButton = document.querySelector(".buy-now");
            if (buyNowButton) {
                buyNowButton.setAttribute("data-price-id", priceId || "");
            }
        } catch (error) {
            console.error('Error fetching Price ID:', error);
            const buyNowButton = document.querySelector(".buy-now");
            if (buyNowButton) {
                buyNowButton.setAttribute("data-price-id", "");
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('productForm').addEventListener('change', updatePriceId);
        updatePriceId();
    });
    </script>

    <!-- Add to Cart Handler -->
    <script>
    function handleAddToCart(event) {
        event.preventDefault();

        const button = event.target;
        const selectedSize = document.querySelector('input[name="size"]:checked');
        const size = document.querySelector(`label[for="${selectedSize.id}"]`).textContent.trim();
        const selectedFlavor = document.querySelector('input[name="flavor"]:checked');
        const flavor = document.querySelector(`label[for="${selectedFlavor.id}"]`).textContent.trim();
        const selectedOrderType = document.querySelector('input[name="orderType"]:checked');
        const orderTypeSelect = document.querySelector(`label[for="${selectedOrderType.id}"]`).textContent.trim();

        const unitPriceElement = document.getElementById('price');
        const unitPrice = unitPriceElement 
            ? parseFloat(unitPriceElement.textContent.replace('$', '').trim()) || 0.00
            : 0.00;

        const priceId = button.getAttribute('data-price-id') || 'N/A';
        const title = document.querySelector('h1').innerText;
        const quantityField = document.getElementById('quantityAll');
        const quantity = quantityField ? parseInt(quantityField.value, 10) || 1 : 1;

        if (!priceId || priceId === 'N/A') {
            alert('Please select valid options before adding to cart.');
            return;
        }

        const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
        cart.push({
            priceId,
            title,
            size,
            flavor,
            orderType: orderTypeSelect,
            quantity,
            unitPrice,
        });
        localStorage.setItem('cartV2', JSON.stringify(cart));

        const modal = document.getElementById('addedToCartModal');
        if (modal) {
            $('#addedToCartModal').modal('show');
        } else {
            alert('Item added to cart successfully!');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const addToCartButton = document.querySelector('.buy-now');
        if (addToCartButton) {
            addToCartButton.addEventListener('click', handleAddToCart);
        }
    });
    </script>

    <!-- Modal for Add to Cart Confirmation -->
    <div class="modal fade" id="addedToCartModal" tabindex="-1" aria-labelledby="addedToCartModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addedToCartModalLabel">Item Added to Cart</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Your item has been successfully added to the cart. What would you like to do next?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Continue Shopping</button>
                    <a href="/cart" class="btn btn-primary">Go to Cart</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Pair With Quick Add Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function showPairWithToast(productName) {
            var toast = document.getElementById('pairWithToast');
            var productEl = document.getElementById('pairWithToastProduct');
            
            if (toast) {
                if (productEl) {
                    productEl.textContent = productName;
                }
                toast.classList.remove('show');
                void toast.offsetWidth;
                toast.classList.add('show');
                setTimeout(function() {
                    toast.classList.remove('show');
                }, 4000);
            }
            
            if (typeof triggerCartBounce === 'function') {
                triggerCartBounce(productName);
            }
        }
        
        function updatePairWithPrice() {
            if (typeof pricingData === 'undefined') return;
            
            var priceElements = document.querySelectorAll('.pair-with-price');
            priceElements.forEach(function(element) {
                var product = element.getAttribute('data-product');
                var size = element.getAttribute('data-size');
                var orderType = element.getAttribute('data-order-type');
                
                try {
                    var productPricingData = pricingData.tallow.pricing[product];
                    if (Array.isArray(productPricingData)) {
                        var pricingEntry = productPricingData.find(function(entry) {
                            return entry.size.toLowerCase() === size.toLowerCase();
                        });
                        if (pricingEntry && pricingEntry.prices[country_code] && pricingEntry.prices[country_code][orderType]) {
                            var price = pricingEntry.prices[country_code][orderType];
                            element.textContent = '$' + price.toFixed(2);
                        }
                    }
                } catch (error) {
                    console.error('Error updating pair-with price:', error);
                }
            });
        }
        
        setTimeout(updatePairWithPrice, 100);
        
        var pairWithButtons = document.querySelectorAll('.pair-with-quick-add');
        pairWithButtons.forEach(function(button) {
            button.addEventListener('click', function(e) {
                e.preventDefault();
                
                var btn = this;
                if (btn.classList.contains('added')) return;
                
                var product = btn.getAttribute('data-product');
                var orderType = btn.getAttribute('data-order-type');
                var flavor = btn.getAttribute('data-flavor');
                var size = btn.getAttribute('data-size');
                var title = btn.getAttribute('data-title');
                var displaySize = btn.getAttribute('data-display-size');
                var displayFlavor = btn.getAttribute('data-display-flavor');
                var displayOrderType = btn.getAttribute('data-display-order-type');
                var quantity = 1;
                
                if (typeof pricingData === 'undefined') {
                    alert('Unable to add product to cart. Pricing data not available.');
                    return;
                }
                
                var priceId = null;
                var unitPrice = 0;
                
                try {
                    priceId = pricingData.tallow.ids[product][orderType][flavor][size][country_code];
                    var productPricingData = pricingData.tallow.pricing[product];
                    
                    if (Array.isArray(productPricingData)) {
                        var pricingEntry = productPricingData.find(function(entry) {
                            return entry.size.toLowerCase() === size.toLowerCase();
                        });
                        if (pricingEntry && pricingEntry.prices[country_code]) {
                            var pricingOrderType = orderType === 'single' ? 'single_purchase' : 
                                                  orderType === 'pack' ? 'three_pack' : orderType;
                            unitPrice = pricingEntry.prices[country_code][pricingOrderType] || 0;
                        }
                    }
                } catch (error) {
                    console.error('Error fetching data from YAML:', error);
                }
                
                if (!priceId || unitPrice === 0) {
                    alert('Unable to add this product to cart. Please visit the product page.');
                    return;
                }
                
                var cart = JSON.parse(localStorage.getItem('cartV2')) || [];
                cart.push({
                    priceId: priceId,
                    title: title,
                    size: displaySize,
                    flavor: displayFlavor,
                    orderType: displayOrderType,
                    quantity: quantity,
                    unitPrice: unitPrice,
                    eligibleForDiscount: false
                });
                localStorage.setItem('cartV2', JSON.stringify(cart));
                
                btn.textContent = 'Added ✓';
                btn.classList.add('added');
                btn.disabled = true;
                
                if (typeof updateCartBadge === 'function') {
                    updateCartBadge();
                }
                
                showPairWithToast(title);
            });
        });
    });
    </script>

    <!-- Quantity Controls -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const quantityInput = document.getElementById('quantityAll');
        const btnIncrease = document.querySelector('.btn-increase');
        const btnDecrease = document.querySelector('.btn-decrease');

        btnIncrease.addEventListener('click', () => {
            quantityInput.value = parseInt(quantityInput.value) + 1;
        });

        btnDecrease.addEventListener('click', () => {
            const currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
            }
        });
    });
    </script>

    {{- partial "footer.html" . -}}
</body>
</html>
