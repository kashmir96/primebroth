<form id="brothForm">
    <div>
        <label for="size">Select Size:</label>
        <select id="size" name="size">
            <option value="50g">50g</option>
            <option value="90g">90g</option>
            <option value="180g">180g</option>
        </select>
    </div>
    <div>
        <label for="flavor">Select Flavor:</label>
        <select id="flavor" name="flavor">
            <option value="beef">Beef</option>
            <option value="chicken">Chicken</option>
            <option value="duck">Duck</option>
            <option value="fish">Fish</option>
            <option value="lamb">Lamb</option>
            <option value="venison">Venison</option>
            <option value="pork">Pork</option>
        </select>
    </div>
    <div>
        <label for="orderType">Select Order Type:</label>
        <select id="orderType" name="orderType">
            <option value="single_purchase">Single Purchase</option>
            <option value="recurring_monthly">Recurring Monthly</option>
            <option value="recurring_quarterly">Recurring Quarterly</option>
            <option value="three_pack">Three-Pack</option>
        </select>
    </div>
    <div class="price-display">
        <p>Price: <span id="price">-</span></p>
        <p>Price ID: <span id="price-id">-</span></p>

    </div>
</form>

<script>
    const brothPricingRaw = {{ site.Data.pricing.broth.broth_pricing | jsonify | safeJS }};
    console.log("Raw Broth Pricing from Hugo:", brothPricingRaw);

    const brothPricing = Array.isArray(brothPricingRaw) ? brothPricingRaw : [];
    if (!Array.isArray(brothPricing)) {
        console.error("brothPricing is not an array. Ensure your YAML structure and Hugo data access.");
    } else {
        console.log("Parsed Broth Pricing:", brothPricing);
    }

    function updatePrice() {
        const size = document.getElementById("size").value.trim().toLowerCase();
        const orderType = document.getElementById("orderType").value.trim().toLowerCase();

        console.log("Selected size:", size);
        console.log("Selected order type:", orderType);

        const pricingEntry = brothPricing.find(entry => entry.size.toLowerCase() === size);
        if (pricingEntry && pricingEntry.prices[orderType]) {
            const price = pricingEntry.prices[orderType];
            document.getElementById("price").textContent = `$${price.toFixed(2)}`;
        } else {
            document.getElementById("price").textContent = "N/A";
        }
    }

    // Attach event listener for changes
    document.getElementById("brothForm").addEventListener("change", updatePrice);

    // Initialize the price on page load
    document.addEventListener("DOMContentLoaded", updatePrice);
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize display on page load
        initializeDisplay();

        // Attach event listeners for form changes
        document.getElementById('brothForm').addEventListener('change', function () {
            updatePrice();
            updatePriceID();
        });
    });

    // Function to initialize both displays on page load
    function initializeDisplay() {
        if (brothPricingRaw) {
            console.log("Initializing display...");
            updatePrice();
            updatePriceID();
        } else {
            console.error("brothPricingRaw is not loaded. Check your data source.");
        }
    }

    // Function to update the price display
    function updatePrice() {
        const size = document.getElementById("size").value.trim().toLowerCase();
        const orderType = document.getElementById("orderType").value.trim().toLowerCase();

        let price = "N/A";

        const pricingEntry = brothPricing.find(entry => entry.size.toLowerCase() === size);
        if (pricingEntry && pricingEntry.prices[orderType]) {
            price = `$${pricingEntry.prices[orderType].toFixed(2)}`;
        }

        document.getElementById("price").textContent = price;
        console.log("Price updated to:", price);
    }

    // Function to update the price ID display
    function updatePriceID() {
        const size = document.getElementById("size").value.trim().toLowerCase();
        const flavor = document.getElementById("flavor").value.trim().toLowerCase();
        const orderType = document.getElementById("orderType").value.trim().toLowerCase();

        let priceID = "N/A";

        if (brothPricingRaw && brothPricingRaw.broth_ids && brothPricingRaw.broth_ids.people) {
            const peopleData = brothPricingRaw.broth_ids.people;
            const orderTypeData = peopleData[orderType];

            if (orderTypeData && orderTypeData[flavor]) {
                const flavorData = orderTypeData[flavor];
                const sizeData = flavorData[size];

                if (sizeData) {
                    priceID = sizeData;
                }
            }
        }

        document.getElementById("price-id").textContent = priceID !== "N/A" ? priceID : "Price ID Not Available";
        console.log("Price ID updated to:", priceID);
    }
</script>

