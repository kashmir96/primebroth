<!-- Sensitive Skin Routine Section -->
<div class="section light-peach py-5 mt-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold mb-4">Our sensitive skin & anti-redness routine</h2>
        </div>

        <!-- Morning Routine -->
        <div class="mb-5">
            <h3 class="h4 fw-bold mb-4">Morning</h3>
            <div class="row g-4">
                <!-- Product 1: Tallow Shampoo -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge bg-danger">PRESALE - Online Exclusive</span>
                                <span class="h6 fw-bold text-muted">1.</span>
                            </div>
                            <div class="text-center mb-3">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-liquid-shampoo">
                                    <img src="/img/liqshampoo-shop.webp" alt="Tallow Shampoo 500ml" class="img-fluid" style="max-height: 200px;">
                                </a>
                            </div>
                            <p class="h5 fw-bold product-price" 
                               data-product="liqshampoo"
                               data-size="500ml"
                               data-order-type="single_purchase">
                                Loading...
                            </p>
                            <p class="h6 fw-bold mb-2">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-liquid-shampoo" class="text-decoration-none text-dark">
                                    Tallow Shampoo 500ml
                                </a>
                            </p>
                            <p class="text-muted small mb-3">New Product!</p>
                            <p class="small">Gentle scalp supporting tallow shampoo & conditioner</p>
                            <button 
                                class="btn btn-pink w-100 mt-3 quick-add-to-cart" 
                                data-product="liqshampoo"
                                data-order-type="single"
                                data-flavor="geranium"
                                data-size="500ml"
                                data-title="Tallow Shampoo 500ml"
                                data-display-size="500ml"
                                data-display-flavor="Fresh Geranium"
                                data-display-order-type="Single bottle"
                                data-product-url="https://www.primalpantry.co.nz/shop/products/tallow-liquid-shampoo">
                                Quick Add
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product 2: Tallow + Zinc Summer Balm -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge bg-secondary">Online Exclusive</span>
                                <span class="h6 fw-bold text-muted">2.</span>
                            </div>
                            <div class="text-center mb-3">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-summerbalm">
                                    <img src="/img/summer.webp" alt="Tallow + Zinc Summer Balm" class="img-fluid" style="max-height: 200px;">
                                </a>
                            </div>
                            <p class="h5 fw-bold product-price" 
                               data-product="summer_balm"
                               data-size="30ml"
                               data-order-type="single_purchase">
                                Loading...
                            </p>
                            <p class="h6 fw-bold mb-2">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-summerbalm" class="text-decoration-none text-dark">
                                    Tallow + Zinc Summer Balm
                                </a>
                            </p>
                            <p class="text-muted small mb-3">700+ Kiwis</p>
                            <p class="small">A barrier building balm to protect irritated skin from the kiwi summer elements.</p>
                            <button 
                                class="btn btn-pink w-100 mt-3 quick-add-to-cart" 
                                data-product="summer_balm"
                                data-order-type="single"
                                data-flavor="rose_zinc"
                                data-size="30ml"
                                data-title="Tallow + Zinc Summer Balm"
                                data-display-size="30ml"
                                data-display-flavor="Rose + Zinc"
                                data-display-order-type="Single jar"
                                data-product-url="https://www.primalpantry.co.nz/shop/products/tallow-summerbalm">
                                Quick Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Evening Routine -->
        <div>
            <h3 class="h4 fw-bold mb-4">Evening</h3>
            <div class="row g-4">
                <!-- Product 3: Tallow Cleanser -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge bg-secondary">Online Exclusive</span>
                                <span class="h6 fw-bold text-muted">3.</span>
                            </div>
                            <div class="text-center mb-3">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-cleanser">
                                    <img src="/img/cleanser/tallow-cleasner-productpage.webp" alt="Tallow Cleanser" class="img-fluid" style="max-height: 200px;">
                                </a>
                            </div>
                            <p class="h5 fw-bold product-price" 
                               data-product="cleanser"
                               data-size="100ml"
                               data-order-type="single_purchase">
                                Loading...
                            </p>
                            <p class="h6 fw-bold mb-2">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-cleanser" class="text-decoration-none text-dark">
                                    Tallow Cleanser
                                </a>
                            </p>
                            <p class="text-muted small mb-3">New</p>
                            <p class="small">A gentle cleanser to lift makeup and dirt while leaving the skin happy</p>
                            <button 
                                class="btn btn-pink w-100 mt-3 quick-add-to-cart" 
                                data-product="cleanser"
                                data-order-type="single"
                                data-flavor="geranium"
                                data-size="100ml"
                                data-title="Tallow Cleanser"
                                data-display-size="100ml"
                                data-display-flavor="Rose Geranium"
                                data-display-order-type="Single bottle"
                                data-product-url="https://www.primalpantry.co.nz/shop/products/tallow-cleanser">
                                Quick Add
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product 4: Tallow & Honey Balm 120ml -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge bg-warning text-dark">Best Seller</span>
                                <span class="h6 fw-bold text-muted">4.</span>
                            </div>
                            <div class="text-center mb-3">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-honey-balm">
                                    <img src="/img/shop/honeyshop.webp" alt="Tallow & Honey Balm" class="img-fluid" style="max-height: 200px;">
                                </a>
                            </div>
                            <p class="h5 fw-bold product-price" 
                               data-product="honeybalm"
                               data-size="120ml"
                               data-order-type="single_purchase">
                                Loading...
                            </p>
                            <p class="h6 fw-bold mb-2">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-honey-balm" class="text-decoration-none text-dark">
                                    Tallow & Honey Balm 120ml
                                </a>
                            </p>
                            <p class="text-muted small mb-3">20,000+ Kiwis</p>
                            <p class="small">A nourishing tallow balm to rebuild and repair after a long day.</p>
                            <button 
                                class="btn btn-pink w-100 mt-3 quick-add-to-cart" 
                                data-product="honeybalm"
                                data-order-type="single"
                                data-flavor="vanilla"
                                data-size="120ml"
                                data-title="Tallow & Honey Balm 120ml"
                                data-display-size="120ml"
                                data-display-flavor="Vanilla & Manuka"
                                data-display-order-type="Single jar"
                                data-product-url="https://www.primalpantry.co.nz/shop/products/tallow-honey-balm">
                                Quick Add
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product 5: Tallow Eye Cream -->
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 border-0 shadow-sm">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <span class="badge bg-secondary">Online Exclusive</span>
                                <span class="h6 fw-bold text-muted">5.</span>
                            </div>
                            <div class="text-center mb-3">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-eye-cream">
                                    <img src="/img/shop/eyecream.webp" alt="Tallow Eye Cream" class="img-fluid" style="max-height: 200px;">
                                </a>
                            </div>
                            <p class="h5 fw-bold product-price" 
                               data-product="eyecream"
                               data-size="10ml"
                               data-order-type="single_purchase">
                                Loading...
                            </p>
                            <p class="h6 fw-bold mb-2">
                                <a href="https://www.primalpantry.co.nz/shop/products/tallow-eye-cream" class="text-decoration-none text-dark">
                                    Tallow Eye Cream
                                </a>
                            </p>
                            <p class="text-muted small mb-3">8,000+ Kiwis</p>
                            <p class="small">A lightweight brightening undereye cream to support your most sensitive skin.</p>
                            <button 
                                class="btn btn-pink w-100 mt-3 quick-add-to-cart" 
                                data-product="eyecream"
                                data-order-type="single"
                                data-flavor="manukahoney_vitc"
                                data-size="10ml"
                                data-title="Tallow Eye Cream"
                                data-display-size="15ml"
                                data-display-flavor="Manuka Honey & Vitamin C"
                                data-display-order-type="Single jar"
                                data-product-url="https://www.primalpantry.co.nz/shop/products/tallow-eye-cream">
                                Quick Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.btn-pink {
    background-color: #ffb6c1;
    color: #000;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-pink:hover {
    background-color: #ff9eb0;
    color: #000;
}

.btn-pink:disabled {
    background-color: #98fb98;
    color: #000;
    cursor: default;
}

.btn-pink.added {
    background-color: #98fb98;
    color: #000;
}

.card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.1) !important;
}

.light-peach {
    background-color: #fef5f1;
}
</style>

<!-- Quick Add to Cart for Routine Products -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // Update all product prices from YAML data
    function updateProductPrices() {
        const priceElements = document.querySelectorAll('.product-price');
        
        priceElements.forEach(element => {
            const product = element.getAttribute('data-product');
            const size = element.getAttribute('data-size');
            const orderType = element.getAttribute('data-order-type');
            
            try {
                const productPricingData = pricingData.tallow.pricing[product];
                
                if (Array.isArray(productPricingData)) {
                    const pricingEntry = productPricingData.find(entry => 
                        entry.size.toLowerCase() === size.toLowerCase()
                    );
                    
                    if (pricingEntry && pricingEntry.prices[country_code] && pricingEntry.prices[country_code][orderType]) {
                        const price = pricingEntry.prices[country_code][orderType];
                        element.textContent = `$${price.toFixed(2)}`;
                        
                        console.log('Updated price for:', {
                            product,
                            size,
                            orderType,
                            price
                        });
                    } else {
                        element.textContent = 'N/A';
                        console.warn('Price not found for:', { product, size, orderType, country_code });
                    }
                } else {
                    element.textContent = 'N/A';
                    console.warn('Pricing data not array for product:', product);
                }
            } catch (error) {
                console.error('Error updating price:', error);
                element.textContent = 'N/A';
            }
        });
    }
    
    updateProductPrices();
    
    // Handle all quick add to cart buttons
    const quickAddButtons = document.querySelectorAll('.quick-add-to-cart');
    
    quickAddButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Check if already added
            if (this.classList.contains('added')) {
                return;
            }
            
            const product = this.getAttribute('data-product');
            const orderType = this.getAttribute('data-order-type');
            const flavor = this.getAttribute('data-flavor');
            const size = this.getAttribute('data-size');
            
            const title = this.getAttribute('data-title');
            const displaySize = this.getAttribute('data-display-size');
            const displayFlavor = this.getAttribute('data-display-flavor');
            const displayOrderType = this.getAttribute('data-display-order-type');
            const quantity = 1;
            
            let priceId = null;
            let unitPrice = 0;
            
            try {
                priceId = pricingData.tallow.ids[product][orderType][flavor][size][country_code];
                
                const productPricingData = pricingData.tallow.pricing[product];
                
                if (Array.isArray(productPricingData)) {
                    const pricingEntry = productPricingData.find(entry => 
                        entry.size.toLowerCase() === size.toLowerCase()
                    );
                    
                    if (pricingEntry && pricingEntry.prices[country_code]) {
                        const pricingOrderType = orderType === 'single' ? 'single_purchase' : 
                                                orderType === 'pack' ? 'three_pack' : orderType;
                        
                        unitPrice = pricingEntry.prices[country_code][pricingOrderType] || 0;
                    }
                }
                
                console.log('Retrieved data:', {
                    product,
                    orderType,
                    flavor,
                    size,
                    country_code,
                    priceId,
                    unitPrice
                });
                
            } catch (error) {
                console.error('Error fetching data from YAML:', error);
                console.error('Data path attempted:', {
                    product,
                    orderType,
                    flavor,
                    size,
                    country_code
                });
            }
            
            if (!priceId || unitPrice === 0) {
                console.error('Invalid price data for product:', title);
                alert('Unable to add this product to cart. Please visit the product page.');
                return;
            }
            
            const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
            
            cart.push({
                priceId: priceId,
                title: title,
                size: displaySize,
                flavor: displayFlavor,
                orderType: displayOrderType,
                quantity: quantity,
                unitPrice: unitPrice,
                eligibleForDiscount: false
            });
            
            localStorage.setItem('cartV2', JSON.stringify(cart));
            
            // Update button to stay as "Added!" permanently
            this.textContent = 'Added!';
            this.classList.add('added');
            this.disabled = true;
            
            updateCartBadge();
            
            console.log('Added to cart:', {
                priceId, 
                title, 
                size: displaySize, 
                flavor: displayFlavor, 
                orderType: displayOrderType, 
                quantity, 
                unitPrice
            });
        });
    });
    
    // Shared cart badge update function
    function updateCartBadge() {
        const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
        const cartBadges = document.querySelectorAll('.cart-badge');
        
        if (cart.length > 0) {
            cartBadges.forEach(badge => {
                badge.style.display = 'flex';
                badge.textContent = cart.length;
            });
        } else {
            cartBadges.forEach(badge => {
                badge.style.display = 'none';
            });
        }
    }
    
    updateCartBadge();
});

// Make updateCartBadge available globally for the bundle add to cart
function updateCartBadge() {
    const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
    const cartBadges = document.querySelectorAll('.cart-badge');
    
    if (cart.length > 0) {
        cartBadges.forEach(badge => {
            badge.style.display = 'flex';
            badge.textContent = cart.length;
        });
    } else {
        cartBadges.forEach(badge => {
            badge.style.display = 'none';
        });
    }
}
</script>
