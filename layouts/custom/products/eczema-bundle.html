<!DOCTYPE html>
<html lang="en">
<head>
    {{- partial "head.html" . -}}
    <meta name="description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta property="og:title" content="{{ .Site.Params.homepage_meta_tags.meta_og_title }}" />
    <meta property="og:type" content="{{ .Site.Params.homepage_meta_tags.meta_og_type }}" />
    <meta property="og:url" content="{{ .Site.Params.homepage_meta_tags.meta_og_url }}" />
    <meta property="og:image" content="{{ .Site.Params.homepage_meta_tags.meta_og_image }}" />
    <meta property="og:description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
    <meta name="twitter:card" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_card }}" />
    <meta name="twitter:site" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_site }}" />
    <meta name="twitter:creator" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_creator }}" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<style>
.custom-radio.out-of-stock input[type="radio"]:checked + .custom-radio-label::before {
    background-color: red;
}

.custom-radio.in-stock input[type="radio"]:checked + .custom-radio-label::before {
    background-color: green;
}

.custom-radio-label {
    color: inherit;
}

input.is-disabled {
  pointer-events: none;
}

input.is-disabled + label {
  opacity: 0.4;
  cursor: not-allowed;
  pointer-events: none;
}

input.is-disabled + label img {
  filter: grayscale(100%);
}
</style>

{{- partial "alert.html" . -}}
{{- partial "header_new.html" . -}}

<div class="container product-page">
    <div class="row topbanner rel">
        <p class="text-dark col-12 ninety mt-1"><a href="/shop" class="text-dark text-decoration-underline">Shop</a> > Tallow Shampoo Bar</p>
        <div class="col-12 col-lg-6 product-photos mb-3">
            <div class="row">
                <div class="product-images">
                    <img class="product-image" src="/img/shampoobar/tallow-shampoo-bar-product-benifitswebp.webp" alt="Shampoo bar benefits">
                    <img class="product-image" src="/img/shampoo-hands.webp" alt="Shampoo bar in hands">
                    <img class="product-image" src="/img/shampoo-shop.webp" alt="Shampoo bar product">
                </div>
                <img class="main-image" fetchpriority="high" src="/img/shampoobar/shampoo-bar.webp" alt="Main Product Image">
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <p class="fw-bold mt-2">Online Only - Not in Stores</p>
            <h1 class="fw-bold mt-2">Tallow Shampoo Bar</h1>
            <h2 class="fw-lighter h1 h1big">Scalp Health Natural Shampoo</h2>
            <p class="graytxt fw-bold">From <span class="fst-italic" style="color: rgb(177, 152, 9)">PrimalCare</span></p>
            <p class="fw-lighter">Glowing hair, healthy scalp—your friends will <span class="attention-primalcare">beg for your secret!</span></p>

            <!-- Product Form Options with Bootstrap Styling -->
            <div class="price-display thic">
                <p class="mb-2"><span id="price">-</span></p><span class="attention-primalcare"> (This is 30% off)</span>
                <p class="thin">or 4 interest free payments of $<span id="afterpay_price"></span> with <img src="/img/afterpay.webp" class="d-inline" height="28"></p>                
            </div>

            <form id="productForm" class="form-group mb-4" autocomplete="off">
                <div class="text-left mb-3 mb-lg-4">
                    <label class="mob-ninety">Select unit type:</label>

                    <input type="radio" id="single_purchase" name="orderType" value="single_purchase" checked>
                    <label for="single_purchase" class="product-form-radio"><img class="prod-radio-img" src="/img/radio/resell/Shampoo.webp">Single block</label>

                    <input type="radio" id="three_pack" name="orderType" value="three_pack">
                    <label for="three_pack" class="product-form-radio"><img class="prod-radio-img" src="/img/radio/resell/Shampoo.webp" alt="3 pack shampoo">3 pack <span class="attention-primalcare small">(Save 33% + GIFT)</span></label>
                </div>

                <div class="text-left mb-3 mb-lg-4" style="display:none;">
                    <label class="mob-ninety">Select type:</label>

                    <input type="radio" id="peppermintrosemary" name="flavor" value="peppermintrosemary" checked>
                    <label for="peppermintrosemary" class="product-form-radio">Natural</label>
                </div>

                <div class="text-left mb-3 mb-lg-4" style="display:none;">
                    <label class="float-left mob-ninety mr-2 mt-2">Select size:</label>
                    <div class="product-form-radio">
                        <input type="radio" id="size120g" name="size" value="120g" checked>
                        <label for="size120g" class="product-form-radio float-left"><img class="prod-radio-img" src="/img/radio/resell/Shampoo.webp" alt="shampoo">120g</label>
                    </div>
                </div>

                <!-- Quantity Selector -->
                <div class="form-group mb-3 mb-lg-4">
                    <div class="mt-4 custom-radio float-end">
                        <input type="radio" id="inStock" name="stockStatus" checked>
                        <label class="custom-radio-label mb-0" for="inStock">In Stock</label>
                    </div>
                    <label for="quantityAll" class="form-label">Quantity of units:</label>
                    <div class="quantity-container">
                        <button type="button" class="btn-decrease">-</button>
                        <input type="number" class="form-control" id="quantityAll" name="quantity" min="1" value="1">
                        <button type="button" class="btn-increase">+</button>
                    </div>
                </div>

                <!-- Add to Cart Button -->
                <div class="add-to-cart text-center mb-4">
                    <button type="button" class="btn btn-black btn-lg buy-now mb-2" data-price-id="" data-quantity-id="quantityAll">Add To Cart</button>
                    <p>Speedy Shipping NZ Wide | Money back guarantee</p>
                    <img class="badges middle" src="/img/stripe-badge-transparent.webp" alt="stripe secure badges">
                </div>
            </form>
        </div>
    </div>

    <div class="row mt-4 py-0 d-flex justify-content-center">
        <div class="col-12 col-md-6 text-center">
            <div class="col-12 text-center">
                <h2>As Featured on</h2>
                <div class="col-12 d-none d-md-block">
                    <img src="/img/shop/desktop-product-logos.webp" class="img-fluid">
                </div>
                <div class="col-12 d-block d-md-none">
                    <img src="/img/shop/mobile-logos.webp" class="img-fluid">
                </div>
            </div>
            <div class="row mt-4 mb-0 py-0">
                <div class="col-6">
                    <img src="/img/prod/balm/eczema.webp" alt="eczema">
                </div>
                <div class="col-6">
                    <img src="/img/prod/balm/baby-eczema.webp" alt="baby eczema">
                </div>
                <p>With oils closely mimicking those produced by our bodies, our tallow <span class="attention-primalcare">soothes dry and irritated scalp</span></p>
            </div>
        </div>

        <div class="faq-tab-container col-12 col-md-6">
            <!-- Nav tabs -->
            <div class="faq-nav-tabs">
                <div class="faq-nav-tab active" id="description-tab" data-toggle="tab" href="#description" role="tab" aria-controls="description" aria-selected="true">Fast facts</div>
                <div class="faq-nav-tab" id="reviews-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="reviews" aria-selected="false">Reviews</div>
                <div class="faq-nav-tab" id="ingredients-tab" data-toggle="tab" href="#ingredients" role="tab" aria-controls="ingredients" aria-selected="false">Ingredients</div>
                <div class="faq-nav-tab" id="directions-tab" data-toggle="tab" href="#directions" role="tab" aria-controls="directions" aria-selected="false">Directions</div>
                <div class="faq-nav-tab" id="shipping-tab" data-toggle="tab" href="#shipping" role="tab" aria-controls="shipping" aria-selected="false">Shipping</div>
            </div>

            <!-- Tab panes -->
            <div class="tab-content faq-tab-content">
                <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
                    <h4>Why use a tallow shampoo bar?</h4>
                    <p>Don't waste another dollar on chemical-laden shampoos that strip your hair and irritate your scalp!</p>
                    <p>Cleanse, moisturize, and nourish your hair with a tallow shampoo bar—hydrating and soothing dryness, psoriasis, or eczema on the scalp.</p>
                    <p>Gentle yet effective, it leaves your hair clean, soft, and conditioned—all without the plastic waste of traditional bottles.</p>
                    <p>Give your hair and scalp the love they deserve with a shampoo bar gifted straight from Mother Nature!</p>
                </div>

                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                    <h4>See what our customers say online</h4>
                    <img class="eighty middle" src="/img/prod/shampoo/shampooreviews.webp" alt="reviews">
                </div>

                <div class="tab-pane fade" id="ingredients" role="tabpanel" aria-labelledby="ingredients-tab">
                    <h4>Ingredients</h4>
                    <ul>
                        <li>Grass-Fed Beef Tallow</li>
                        <li>Olive Oil</li>
                        <li>Coconut Oil</li>
                        <li>Castor Oil</li>
                        <li>Lye (none remains in product after 4 weeks of curing)</li>
                        <li>Peppermint Essential Oil</li>
                        <li>Rosemary Essential Oil</li>
                    </ul>

                    <div class="row text-center">
                        <div class="col-6">
                            <h5 class="fw-bold">Grass-fed tallow</h5>
                            <p>We use high-grade, grass-fed suet that's wet rendered and filtered for purity — rich in natural fats that deeply nourish and protect your scalp.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Coconut Oil</h5>
                            <p>A natural cleanser that helps remove buildup while conditioning the hair, leaving it soft and manageable.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Olive Oil</h5>
                            <p>Rich in antioxidants and vitamins, olive oil deeply moisturizes and adds shine without weighing hair down.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Castor Oil</h5>
                            <p>Known for promoting healthy hair growth and adding thickness, castor oil nourishes the scalp and strengthens hair follicles.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Peppermint Essential Oil</h5>
                            <p>Stimulates the scalp with a refreshing tingle, promoting circulation and leaving your hair smelling fresh.</p>
                        </div>
                        <div class="col-6">
                            <h5 class="fw-bold">Rosemary Essential Oil</h5>
                            <p>Supports scalp health and hair growth while providing a pleasant, herbal aroma.</p>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="directions" role="tabpanel" aria-labelledby="directions-tab">
                    <h4>Directions</h4>
                    <p>Lather in your hands before running them through your hair. Rinse after washing hair. Try to keep the block dry to avoid it decaying prematurely.</p>
                    <h4>Storage</h4>
                    <p>Store in a dry, cool place away from direct sunlight to extend the shelf life of the soap.</p>
                </div>

                <div class="tab-pane fade" id="shipping" role="tabpanel" aria-labelledby="shipping-tab">
                    <h4>Shipping</h4>
                    <p><strong>Processing time:</strong> Your order will be processed within 3 business days after which you can expect usual courier times to your area (generally 3-5 business days)</p>
                    <p><strong>Shipping rates:</strong> We usually charge between $4.95 and $6.95 for shipping. You can view the shipping costs at the checkout before completing your purchase.</p>
                    <p><strong>International shipping:</strong> Currently, we only offer shipping within New Zealand. We apologize for any inconvenience this may cause.</p>
                    <p>If you have any questions or concerns regarding shipping, please don't hesitate to <a href="/contact/">contact us</a>.</p>
                </div>
            </div>
        </div>
    </div>
</div>

{{- partial "irritation-routine.html" . -}}

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var tabs = document.querySelectorAll('.faq-nav-tab');
        tabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelector('.faq-nav-tab.active').classList.remove('active');
                tab.classList.add('active');
                var tabContent = document.querySelector('.faq-tab-content .tab-pane.show.active');
                tabContent.classList.remove('show', 'active');
                var target = tab.getAttribute('href');
                document.querySelector(target).classList.add('show', 'active');
            });
        });
    });
</script>

<script>
    const productPricingRaw = {{ site.Data.pricing.tallow.pricing.shampoo | jsonify | safeJS }};
    console.log("Raw product Pricing from Hugo:", productPricingRaw);
    const country_code = getCountryCookie('country_code') || "NZ";

    const productPricing = Array.isArray(productPricingRaw) ? productPricingRaw : [];
    if (!Array.isArray(productPricing)) {
        console.error("productPricing is not an array. Ensure your YAML structure and Hugo data access.");
    } else {
        console.log("Parsed product Pricing:", productPricing);
    }

    function updatePrice() {
        const size = document.querySelector('input[name="size"]:checked').value.trim().toLowerCase();
        const orderType = document.querySelector('input[name="orderType"]:checked').value.trim().toLowerCase();

        console.log("Selected size:", size);
        console.log("Selected order type:", orderType);

        const pricingEntry = productPricing.find(entry => entry.size.toLowerCase() === size);
        if (pricingEntry && pricingEntry.prices[country_code][orderType]) {
            const price = pricingEntry.prices[country_code][orderType];
            document.getElementById("price").textContent = `$${price.toFixed(2)}`;
            document.getElementById("afterpay_price").textContent = `${(price/4).toFixed(2)}`;
        } else {
            document.getElementById("price").textContent = "N/A";
            document.getElementById("afterpay_price").textContent = "N/A";
        }
    }

    document.getElementById("productForm").addEventListener("change", updatePrice);
    document.addEventListener("DOMContentLoaded", updatePrice);
</script>

<script>
    function updatePriceID() {
        const size = document.querySelector('input[name="size"]:checked').value.trim().toLowerCase();
        const flavor = document.querySelector('input[name="flavor"]:checked').value.trim().toLowerCase();
        const orderType = document.querySelector('input[name="orderType"]:checked').value.trim().toLowerCase();

        let priceID = "N/A";

        console.log("Loaded Data:", productPricingRaw);
        console.log("Selected - Size:", size, "Flavor:", flavor, "Order Type:", orderType);

        if (productPricingRaw && productPricingRaw.ids && productPricingRaw.ids.shampoo) {
            const shampooData = productPricingRaw.ids.shampoo;
            console.log("Shampoo Data:", shampooData);

            const orderTypeData = shampooData[orderType];
            console.log("Order Type Data:", orderTypeData);

            if (orderTypeData && orderTypeData[flavor]) {
                const flavorData = orderTypeData[flavor];
                console.log("Flavor Data:", flavorData);

                const sizeData = flavorData[size];
                console.log("Size Data:", sizeData);

                if (sizeData) {
                    priceID = sizeData[country_code];
                }
            }
        }

        const priceIdElement = document.getElementById("price-id");
        if (priceIdElement) {
            priceIdElement.textContent = priceID !== "N/A" ? priceID : "Price ID Not Available";
        }

        console.log("Resolved Price ID:", priceID);
    }
</script>

<script>
    const rawData = "{{ .Site.Data.pricing | jsonify }}";
    const pricingData = JSON.parse(rawData);
    console.log('Parsed Pricing Data:', pricingData);

    function updatePriceId() {
        const size = document.querySelector('input[name="size"]:checked').value.trim().toLowerCase();
        const flavor = document.querySelector('input[name="flavor"]:checked').value.trim().toLowerCase();
        const orderType = document.querySelector('input[name="orderType"]:checked').value.trim().toLowerCase();

        try {
            let priceId;

            if (orderType === 'single_purchase') {
                priceId = pricingData.tallow.ids.shampoo.single[flavor][size][country_code];
            } else if (orderType === 'recurring_monthly') {
                priceId = pricingData.tallow.ids.shampoo.monthly[flavor][size][country_code];
            } else if (orderType === 'recurring_quarterly') {
                priceId = pricingData.tallow.ids.shampoo.quarterly[flavor][size][country_code];
            } else if (orderType === 'three_pack') {
                priceId = pricingData.tallow.ids.shampoo.pack[flavor][size][country_code];
            }

            console.log('Price ID:', priceId);

            const priceIdElement = document.getElementById('price-id');
            if (priceIdElement) {
                priceIdElement.textContent = priceId || 'Price ID not found';
            }

            const buyNowButton = document.querySelector(".buy-now");
            if (buyNowButton) {
                buyNowButton.setAttribute("data-price-id", priceId || "");
                console.log('Button updated with Price ID:', priceId);
            }
        } catch (error) {
            console.error('Error fetching Price ID:', error);

            const buyNowButton = document.querySelector(".buy-now");
            if (buyNowButton) {
                buyNowButton.setAttribute("data-price-id", "");
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('productForm').addEventListener('change', updatePriceId);
        updatePriceId();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        function preprocessproductData(rawData) {
            const simplified = {};

            if (rawData.ids && rawData.ids.shampoo) {
                const categories = rawData.ids.shampoo;

                for (const [orderType, flavors] of Object.entries(categories)) {
                    for (const [flavor, sizes] of Object.entries(flavors)) {
                        for (const [size, priceId] of Object.entries(sizes)) {
                            if (!simplified[size]) {
                                simplified[size] = {};
                            }
                            if (!simplified[size][flavor]) {
                                simplified[size][flavor] = {};
                            }
                            simplified[size][flavor][orderType] = priceId;
                        }
                    }
                }
            }
            return simplified;
        }

        const normalizedproductData = preprocessproductData(productPricingRaw);
        console.log('Normalized product Data:', normalizedproductData);

        function getPriceID(size, flavor, orderType) {
            return (
                normalizedproductData[size]?.[flavor]?.[orderType] ||
                "Price ID not found"
            );
        }
    });
</script>

<script>
    function handleAddToCart(event) {
        event.preventDefault();

        console.log('Add to Cart button clicked!');

        const button = event.target;

        const selectedSize = document.querySelector('input[name="size"]:checked');
        const size = document.querySelector(`label[for="${selectedSize.id}"]`).textContent.trim();

        const selectedFlavor = document.querySelector('input[name="flavor"]:checked');
        const flavor = document.querySelector(`label[for="${selectedFlavor.id}"]`).textContent.trim();

        const selectedOrderType = document.querySelector('input[name="orderType"]:checked');
        const orderTypeSelect = document.querySelector(`label[for="${selectedOrderType.id}"]`).textContent.trim();

        const unitPriceElement = document.getElementById('price');
        const unitPrice = unitPriceElement
            ? parseFloat(unitPriceElement.textContent.replace('$', '').trim()) || 0.00
            : 0.00;

        const priceId = button.getAttribute('data-price-id') || 'N/A';
        const title = document.querySelector('h1').innerText;

        const quantityField = document.getElementById('quantityAll');
        const quantity = quantityField ? parseInt(quantityField.value, 10) || 1 : 1;

        console.log('Size:', size);
        console.log('Flavor:', flavor);
        console.log('Order Type:', orderTypeSelect);
        console.log('Quantity:', quantity);
        console.log('Price ID:', priceId);

        if (!priceId || priceId === 'N/A') {
            alert('Please select valid options before adding to cart.');
            return;
        }

        const cart = JSON.parse(localStorage.getItem('cartV2')) || [];
        cart.push({
            priceId,
            title,
            size,
            flavor,
            orderType: orderTypeSelect,
            quantity,
            unitPrice,
            eligibleForDiscount: false
        });
        localStorage.setItem('cartV2', JSON.stringify(cart));

        console.log('Cart updated:', cart);

        const modal = document.getElementById('addedToCartModal');
        if (modal) {
            $('#addedToCartModal').modal('show');
        } else {
            alert('Item added to cart successfully!');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const addToCartButton = document.querySelector('.buy-now');
        if (addToCartButton) {
            addToCartButton.addEventListener('click', handleAddToCart);
            console.log('Add to Cart button is ready.');
        } else {
            console.error('Add to Cart button not found!');
        }
    });
</script>

<!-- Modal for Add to Cart Confirmation -->
<div class="modal fade" id="addedToCartModal" tabindex="-1" aria-labelledby="addedToCartModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addedToCartModalLabel">Item Added to Cart</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Your item has been successfully added to the cart. What would you like to do next?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Continue Shopping</button>
                <a href="/cart" class="btn btn-black">Go to Cart</a>
            </div>
        </div>
    </div>
</div>

<script>
    const quantityInput = document.getElementById('quantityAll');
    const btnIncrease = document.querySelector('.btn-increase');
    const btnDecrease = document.querySelector('.btn-decrease');

    btnIncrease.addEventListener('click', () => {
        quantityInput.value = parseInt(quantityInput.value) + 1;
    });

    btnDecrease.addEventListener('click', () => {
        const currentValue = parseInt(quantityInput.value);
        if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const flavorOptions = document.querySelectorAll('input[name="flavor"]');
        const sizeOptions = document.querySelectorAll('input[name="size"]');
        const stockLabel = document.querySelector('label[for="inStock"]');
        const customRadio = document.querySelector('.custom-radio');
        const addToCartButton = document.querySelector('.buy-now');

        const outOfStockCombinations = [];

        function updateStockLabel() {
            const selectedFlavor = document.querySelector('input[name="flavor"]:checked').value;
            const selectedSize = document.querySelector('input[name="size"]:checked').value;

            const isOutOfStock = outOfStockCombinations.some(combo =>
                combo.flavor === selectedFlavor && combo.size === selectedSize
            );

            document.querySelectorAll('.custom-radio').forEach(radio => {
                radio.classList.remove('out-of-stock', 'in-stock');
            });

            if (isOutOfStock) {
                stockLabel.textContent = "Temporarily out of Stock";
                stockLabel.style.color = "red";

                addToCartButton.disabled = true;
                addToCartButton.style.backgroundColor = "gray";
                addToCartButton.style.cursor = "not-allowed";

                document.querySelectorAll('.custom-radio').forEach(radio => {
                    radio.classList.add('out-of-stock');
                });
            } else {
                stockLabel.textContent = "In Stock";
                stockLabel.style.color = "green";

                addToCartButton.disabled = false;
                addToCartButton.style.backgroundColor = "";
                addToCartButton.style.cursor = "pointer";

                document.querySelectorAll('.custom-radio').forEach(radio => {
                    radio.classList.add('in-stock');
                });
            }
        }

        flavorOptions.forEach(option => {
            option.addEventListener('change', updateStockLabel);
        });

        sizeOptions.forEach(option => {
            option.addEventListener('change', updateStockLabel);
        });

        updateStockLabel();
    });
</script>

{{- partial "footer.html" . }}

</body>
</html>
